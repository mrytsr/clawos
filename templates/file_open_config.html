<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ä»¶æ‰“å¼€æ–¹å¼é…ç½® - ClawOS</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #0d1117; color: #c9d1d9; margin: 0; padding: 20px; 
        }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { color: #58a6ff; font-size: 24px; margin-bottom: 8px; }
        .subtitle { color: #8b949e; font-size: 14px; margin-bottom: 24px; }
        
        .card { 
            background: #161b22; border-radius: 12px; padding: 20px; 
            margin-bottom: 16px; border: 1px solid #30363d; 
        }
        
        .section-title { 
            color: #58a6ff; font-size: 14px; font-weight: 600; 
            margin-bottom: 16px; display: flex; align-items: center; gap: 8px; 
        }
        
        .file-group { 
            margin-bottom: 20px; 
        }
        
        .file-group-header { 
            display: flex; align-items: center; gap: 12px; 
            background: #21262d; padding: 12px 16px; border-radius: 8px 8px 0 0;
            border-bottom: 1px solid #30363d;
        }
        
        .file-group-header .icon { font-size: 20px; }
        
        .file-group-header .name { 
            flex: 1; font-weight: 600; font-size: 15px; 
        }
        
        .file-group-header select { 
            background: #0d1117; color: #c9d1d9; border: 1px solid #30363d;
            padding: 8px 12px; border-radius: 6px; font-size: 13px; cursor: pointer;
        }
        
        .file-group-exts { 
            display: flex; flex-wrap: wrap; gap: 6px; padding: 12px 16px;
            background: #0d1117; border-radius: 0 0 8px 8px;
        }
        
        .ext-tag { 
            background: #21262d; padding: 4px 10px; border-radius: 12px; 
            font-size: 12px; color: #8b949e; 
        }
        
        .btn {
            background: #238636; color: #fff; border: none; padding: 10px 20px;
            border-radius: 8px; font-size: 14px; cursor: pointer; font-weight: 500;
        }
        .btn:hover { background: #2ea043; }
        
        .btn-group { display: flex; gap: 12px; margin-top: 20px; }
        
        .preset-btns { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }
        .preset-btn {
            background: #21262d; color: #c9d1d9; border: 1px solid #30363d;
            padding: 6px 12px; border-radius: 20px; font-size: 12px; cursor: pointer;
        }
        .preset-btn:hover { background: #30363d; }
        
        .info { 
            background: #21262d; padding: 12px 16px; border-radius: 8px; 
            font-size: 13px; color: #8b949e; margin-bottom: 16px; 
        }
        
        .toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: #238636; color: #fff; padding: 12px 24px; border-radius: 8px;
            font-size: 14px; z-index: 10000; display: none;
        }
        .toast.show { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateX(-50%) translateY(-10px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš™ï¸ æ–‡ä»¶æ‰“å¼€æ–¹å¼é…ç½®</h1>
        <p class="subtitle">æŒ‰æ–‡ä»¶ç±»å‹åˆ†ç»„è®¾ç½®é»˜è®¤æ‰“å¼€æ–¹å¼</p>
        
        <div class="card">
            <div class="section-title">ğŸ“‹ é¢„è®¾æ–¹æ¡ˆ</div>
            <div class="preset-btns">
                <button class="preset-btn" onclick="loadPreset('default')">é»˜è®¤é…ç½®</button>
                <button class="preset-btn" onclick="loadPreset('preview')">é¢„è§ˆä¼˜å…ˆ</button>
                <button class="preset-btn" onclick="loadPreset('download')">ä¸‹è½½ä¼˜å…ˆ</button>
                <button class="preset-btn" onclick="loadPreset('browser')">æµè§ˆå™¨ä¼˜å…ˆ</button>
            </div>
            
            <div class="info">
                ğŸ’¡ æç¤ºï¼šé€‰æ‹©æ‰“å¼€æ–¹å¼åç‚¹å‡»ä¿å­˜ã€‚åŒä¸€ç±»å‹çš„æ–‡ä»¶ä¼šä½¿ç”¨ç›¸åŒçš„æ‰“å¼€æ–¹å¼ã€‚
            </div>
            
            <div class="section-title">ğŸ“ æ–‡ä»¶ç±»å‹é…ç½®</div>
            <div id="fileGroupList"></div>
            
            <div class="btn-group">
                <button class="btn" onclick="saveConfig()">ä¿å­˜é…ç½®</button>
            </div>
        </div>
    </div>
    
    <div class="toast" id="toast">é…ç½®å·²ä¿å­˜</div>

    <script>
        // æ–‡ä»¶ç±»å‹åˆ†ç»„é…ç½®
        const fileGroups = [
            { 
                id: 'image', icon: 'ğŸ–¼ï¸', name: 'å›¾ç‰‡', 
                exts: ['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp', '.avif'], 
                methods: ['preview-image', 'browser', 'download']
            },
            { 
                id: 'excel', icon: 'ğŸ“Š', name: 'Excelè¡¨æ ¼', 
                exts: ['.xlsx', '.xls', '.xlsm', '.xlsb'], 
                methods: ['preview-excel', 'browser', 'download']
            },
            { 
                id: 'word', icon: 'ğŸ“', name: 'Wordæ–‡æ¡£', 
                exts: ['.docx', '.doc'], 
                methods: ['browser', 'download']
            },
            { 
                id: 'ppt', icon: 'ğŸ“½ï¸', name: 'PPTå¹»ç¯ç‰‡', 
                exts: ['.pptx', '.ppt'], 
                methods: ['browser', 'download']
            },
            { 
                id: 'pdf', icon: 'ğŸ“„', name: 'PDFæ–‡æ¡£', 
                exts: ['.pdf'], 
                methods: ['browser', 'download']
            },
            { 
                id: 'archive', icon: 'ğŸ“¦', name: 'å‹ç¼©åŒ…', 
                exts: ['.zip', '.rar', '.7z', '.tar', '.gz', '.bz2', '.tar.gz', '.tar.bz2', '.tar.xz'], 
                methods: ['preview-archive', 'download']
            },
            { 
                id: 'code', icon: 'ğŸ’»', name: 'ä»£ç æ–‡ä»¶', 
                exts: ['.py', '.js', '.ts', '.jsx', '.tsx', '.vue', '.go', '.rs', '.java', '.c', '.cpp', '.h', '.css', '.scss', '.less', '.xml'], 
                methods: ['edit-code', 'browser', 'download']
            },
            { 
                id: 'json', icon: 'ğŸ“‹', name: 'JSONæ•°æ®', 
                exts: ['.json', '.jsonc'], 
                methods: ['preview-json', 'edit-code', 'browser']
            },
            { 
                id: 'yaml', icon: 'ğŸ“', name: 'é…ç½®æ–‡ä»¶', 
                exts: ['.yaml', '.yml', '.toml', '.ini', '.conf', '.env'], 
                methods: ['edit-yaml', 'browser', 'preview-json']
            },
            { 
                id: 'markdown', icon: 'ğŸ“', name: 'Markdown', 
                exts: ['.md', '.markdown'], 
                methods: ['edit-md', 'browser']
            },
            { 
                id: 'video', icon: 'ğŸ¬', name: 'è§†é¢‘', 
                exts: ['.mp4', '.webm', '.mov', '.avi', '.mkv', '.wmv', '.flv'], 
                methods: ['browser', 'download']
            },
            { 
                id: 'audio', icon: 'ğŸµ', name: 'éŸ³é¢‘', 
                exts: ['.mp3', '.wav', '.flac', '.aac', '.ogg', '.m4a', '.wma'], 
                methods: ['browser', 'download']
            },
            { 
                id: 'text', icon: 'ğŸ“ƒ', name: 'çº¯æ–‡æœ¬', 
                exts: ['.txt', '.log', '.sh', '.bat', '.ps1'], 
                methods: ['browser', 'edit-code', 'download']
            },
            { 
                id: 'web', icon: 'ğŸŒ', name: 'ç½‘é¡µ', 
                exts: ['.html', '.htm', '.css', '.svg'], 
                methods: ['browser', 'download']
            },
        ];

        // æ‰“å¼€æ–¹å¼æ ‡ç­¾
        const methodLabels = {
            'preview-image': 'ğŸ–¼ï¸ å›¾ç‰‡é¢„è§ˆ',
            'preview-excel': 'ğŸ“Š Excelé¢„è§ˆ',
            'preview-archive': 'ğŸ“¦ å‹ç¼©åŒ…é¢„è§ˆ',
            'preview-json': 'ğŸ“‹ JSONé¢„è§ˆ',
            'edit-code': 'âœï¸ ä»£ç ç¼–è¾‘',
            'edit-yaml': 'ğŸ“ é…ç½®ç¼–è¾‘',
            'edit-md': 'ğŸ“ Markdown',
            'browser': 'ğŸŒ æµè§ˆå™¨',
            'download': 'ğŸ“¥ ä¸‹è½½',
        };

        // é¢„è®¾é…ç½®
        const presets = {
            default: {
                image: 'preview-image', excel: 'preview-excel', word: 'browser',
                ppt: 'browser', pdf: 'browser', archive: 'preview-archive',
                code: 'edit-code', json: 'preview-json', yaml: 'edit-yaml',
                markdown: 'edit-md', video: 'browser', audio: 'browser',
                text: 'browser', web: 'browser',
            },
            preview: {
                image: 'preview-image', excel: 'preview-excel', word: 'browser',
                ppt: 'browser', pdf: 'browser', archive: 'preview-archive',
                code: 'edit-code', json: 'preview-json', yaml: 'edit-yaml',
                markdown: 'edit-md', video: 'browser', audio: 'browser',
                text: 'browser', web: 'browser',
            },
            download: {
                image: 'download', excel: 'download', word: 'download',
                ppt: 'download', pdf: 'download', archive: 'download',
                code: 'download', json: 'download', yaml: 'download',
                markdown: 'download', video: 'download', audio: 'download',
                text: 'download', web: 'download',
            },
            browser: {
                image: 'browser', excel: 'browser', word: 'browser',
                ppt: 'browser', pdf: 'browser', archive: 'browser',
                code: 'browser', json: 'browser', yaml: 'browser',
                markdown: 'browser', video: 'browser', audio: 'browser',
                text: 'browser', web: 'browser',
            },
        };

        let currentConfig = {};

        function init() {
            loadConfig();
            renderGroups();
        }

        function renderGroups() {
            const list = document.getElementById('fileGroupList');
            list.innerHTML = fileGroups.map(g => {
                const method = currentConfig[g.id] || g.methods[0];
                return `
                    <div class="file-group">
                        <div class="file-group-header">
                            <span class="icon">${g.icon}</span>
                            <span class="name">${g.name}</span>
                            <select onchange="changeMethod('${g.id}', this.value)">
                                ${g.methods.map(m => 
                                    `<option value="${m}" ${m === method ? 'selected' : ''}>${methodLabels[m] || m}</option>`
                                ).join('')}
                            </select>
                        </div>
                        <div class="file-group-exts">
                            ${g.exts.map(e => `<span class="ext-tag">${e}</span>`).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function changeMethod(groupId, method) {
            currentConfig[groupId] = method;
        }

        function loadPreset(name) {
            currentConfig = { ...presets[name] };
            renderGroups();
            showToast('å·²åŠ è½½ "' + name + '" é¢„è®¾');
        }

        function loadConfig() {
            fetch('/api/file-open-config', { credentials: 'same-origin' })
                .then(r => r.json())
                .then(d => {
                    if (d && d.success && d.data) {
                        currentConfig = d.data;
                    } else {
                        currentConfig = { ...presets.default };
                    }
                    renderGroups();
                })
                .catch(() => {
                    currentConfig = { ...presets.default };
                    renderGroups();
                });
        }

        function saveConfig() {
            fetch('/api/file-open-config', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(currentConfig),
                credentials: 'same-origin'
            })
            .then(r => r.json())
            .then(d => {
                showToast(d.success ? 'é…ç½®å·²ä¿å­˜' : 'ä¿å­˜å¤±è´¥');
            })
            .catch(() => {
                showToast('ä¿å­˜å¤±è´¥');
            });
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        }

        init();
    </script>
</body>
</html>
