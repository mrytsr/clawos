
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>clawdèµ„æºç®¡ç†å™¨</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="{{ url_for('static', filename='js/clipboard.min.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- å…¨å±€å‡½æ•°é¢„åŠ è½½ï¼ˆå¿…é¡»åœ¨æœ€å‰ï¼‰ -->
    <script src="{{ url_for('static', filename='js/globals.js') }}"></script>
    <script src="{{ url_for('static', filename='js/clipboard.js') }}"></script>
    <script src="{{ url_for('static', filename='js/task_poller.js') }}"></script>
    <script src="{{ url_for('static', filename='js/task_actions.js') }}"></script>
    <script>
        window.SERVER_IS_WINDOWS = {{ 'true' if server_is_windows() else 'false' }};
    </script>
    <!-- åŠŸèƒ½æ¨¡å— -->
    <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/terminal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/preview.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bot.js') }}"></script>
    <script src="{{ url_for('static', filename='js/file_browser.js') }}"></script>
    <script src="{{ url_for('static', filename='js/system_monitor.js') }}"></script>
    <!-- ä¸»å…¥å£ -->
    <script src="{{ url_for('static', filename='app.js') }}"></script>
</head>
<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
            line-height: 1.5;
            color: #24292f;
            background-color: #ffffff;
            padding: 20px;
        }
        :root {
            --global-font-size: var(--global-font-size, 14px);
        }
        .container {
            max-width: 980px;
            margin: 0 auto;
            border: 1px solid #d0d7de;
            border-radius: 6px;
            overflow: hidden;
        }
        
        /* é¡¶éƒ¨æ  (é¢åŒ…å±‘) */
        .breadcrumb {
            padding: 16px;
            background-color: #f6f8fa;
            border-bottom: 1px solid #d0d7de;
            font-size: var(--global-font-size, 14px);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .breadcrumb-left {
            display: flex;
            align-items: center;
            gap: 8px;
            overflow: hidden;
            flex: 1;
        }
        .breadcrumb a {
            color: #0969da;
            text-decoration: none;
        }
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        .crumb-sep {
            color: #57606a;
        }
        .up-btn {
            padding: 3px 8px;
            background-color: #f6f8fa;
            border: 1px solid #d0d7de;
            border-radius: 6px;
            color: #24292f;
            text-decoration: none;
            font-size: var(--global-font-size, 12px);
            font-weight: 500;
        }
        .up-btn:hover {
            background-color: #f3f4f6;
            border-color: #1b1f2426;
        }

        /* æ¶ˆæ¯æç¤º */
        .message {
            padding: 10px 16px;
            border-bottom: 1px solid #d0d7de;
            font-size: var(--global-font-size, 14px);
        }
        .success { background-color: #dafbe1; color: #1a7f37; }
        .error { background-color: #ffebe9; color: #cf222e; }

        /* æ–‡ä»¶åˆ—è¡¨åŒºåŸŸ */
        .files-section {
            padding: 0;
        }
        .file-list {
            display: flex;
            flex-direction: column;
        }
        .file-item {
            display: flex;
            align-items: center;
            padding: 8px 16px;
            border-bottom: 1px solid #d0d7de;
            background-color: white;
            transition: background-color 0.2s;
        }
        .file-item:last-child {
            border-bottom: none;
        }
        .file-item:hover {
            background-color: #f6f8fa;
        }

        /* ä¸‰åˆ—å¸ƒå±€ */
        .file-col-icon {
            width: 32px;
            margin-right: 12px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .file-thumbnail {
            width: 32px;
            height: 32px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid #d0d7de;
        }
        .file-icon {
            font-size: 20px;
            color: #57606a;
        }

        .file-col-info {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .file-name {
            font-size: var(--global-font-size, 14px);
            font-weight: 600;
            color: #24292f;
            line-height: 1.25;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .file-name a {
            color: #24292f;
            text-decoration: none;
        }
        .file-name a:hover {
            color: #0969da;
            text-decoration: underline;
        }
        .file-details-inline {
            font-size: var(--global-font-size, 12px);
            color: #57606a;
            margin-top: 2px;
        }

        .file-col-actions {
            margin-left: 16px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .preview-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 4px;
            border-radius: 4px;
            opacity: 0.7;
            transition: opacity 0.2s;
            text-decoration: none;
        }
        .preview-btn:hover {
            opacity: 1;
            background: #f0f0f0;
        }
        .menu-btn {
            background: none;
            color: #57606a;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-size: var(--global-font-size, 16px);
            cursor: pointer;
            border: 1px solid transparent;
        }
        .menu-btn:hover {
            background-color: #f3f4f6;
            color: #24292f;
            border-color: #1b1f2426;
        }

        .empty-directory {
            text-align: center;
            padding: 40px;
            color: #57606a;
            font-size: var(--global-font-size, 14px);
        }

        /* æµ®åŠ¨ä¸Šä¼ æŒ‰é’® (å·²ç§»é™¤) */
        
        /* é¢åŒ…å±‘ä¸­çš„ä¸Šä¼ æŒ‰é’® */
        .upload-btn-inline {
            width: 24px; height: 24px;
            background: #2da44e;
            border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 18px; font-weight: bold;
            cursor: pointer;
            margin-right: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: background 0.2s;
            flex-shrink: 0;
        }
        .upload-btn-inline:hover {
            background: #2c974b;
        }

        /* Bot æ‚¬æµ®æŒ‰é’® (å·²ç§»é™¤ï¼Œæ”¹ç”¨èœå•æŒ‰é’®) */
        
        /* èœå•æŒ‰é’®æ ·å¼ */
        .menu-float-btn {
            position: fixed;
            left: 20px;
            bottom: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #ffffff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            z-index: 1000;
            transition: transform 0.2s;
            border: 1px solid #eee;
        }
        .menu-float-btn:hover { transform: scale(1.1); }
        
        /* å³ä¾§æŠ½å±‰æ ·å¼ */
        .right-drawer {
            position: fixed;
            top: 0;
            right: 0;
            width: 280px;
            height: 100%;
            background: #fff;
            box-shadow: -4px 0 20px rgba(0,0,0,0.15);
            transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            z-index: 2000;
            display: flex;
            flex-direction: column;
        }
        .right-drawer.open {
            transform: translateX(0);
        }
        .right-drawer-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.4);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            z-index: 1999;
        }
        .right-drawer-backdrop.open {
            opacity: 1;
            visibility: visible;
        }
        .right-drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid #eee;
        }
        .right-drawer-content {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }
        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: var(--global-font-size, 16px);
            color: #24292f;
        }
        .menu-item:hover {
            background-color: #f6f8fa;
        }
        .menu-icon {
            font-size: 20px;
        }
        .menu-text {
            font-weight: 500;
        }
        
        /* Bot Drawer æ ·å¼ - ä½¿ç”¨ç»Ÿä¸€ drawer æ ·å¼ */
        #botDrawer {
            max-height: 95vh;
        }
        
        /* æ‹–æ‹½æ‰‹æŸ„ */
        .drawer-handle {
            width: 40px;
            height: 4px;
            background: #ccc;
            border-radius: 2px;
            margin: 12px auto 8px;
            cursor: grab;
        }
        .drawer-handle:active { cursor: grabbing; }
        
        /* Drawer Header */
        .drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 16px;
            border-bottom: 1px solid #eee;
        }
        .drawer-title { font-size: var(--global-font-size, 16px); font-weight: 600; }
        .drawer-close-btn {
            background: none; border: none; font-size: 20px; cursor: pointer; color: #666; padding: 4px;
        }
        
        /* æŠ½å±‰é®ç½©å±‚ */
        .drawer-backdrop {
            position: fixed;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            z-index: 1999;
        }
        .drawer-backdrop.open {
            opacity: 1;
            visibility: visible;
        }
        
        /* Terminal Drawer æ ·å¼ */
        #terminalDrawer {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            background: #1a1a1a;
            border-radius: 16px 16px 0 0;
            transform: translateY(110%);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            max-height: 85vh;
        }
        #terminalDrawer.open {
            transform: translateY(0);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
        }
        #terminalDrawer .drawer-header {
            background: #1a1a1a;
            border-bottom: 1px solid #333;
        }
        #terminalDrawer .drawer-close-btn {
            color: #fff;
        }
        #terminalDrawer .drawer-handle {
            background: #555;
        }
        
        /* Bot Chat æ ·å¼ */
        .bot-container {
            display: flex;
            flex-direction: column;
            flex: 1;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            position: relative;
            min-height: 0; /* é‡è¦ï¼šé˜²æ­¢æº¢å‡º */
        }
        .bot-chat-box {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .bot-message {
            display: flex;
            flex-direction: column;
            max-width: 85%;
            margin-bottom: 0;
        }
        .bot-message.user { align-self: flex-end; align-items: flex-end; }
        .bot-message.bot { align-self: flex-start; align-items: flex-start; }
        .bot-message.system { align-self: center; max-width: 90%; align-items: center; margin: 10px auto; }
        
        .bot-message .text {
            padding: 10px 14px;
            border-radius: 8px;
            font-size: var(--global-font-size, 14px);
            line-height: 1.5;
            word-break: break-word;
            white-space: pre-wrap; /* ä¿ç•™æ¢è¡Œ */
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace; /* ç­‰å®½å­—ä½“ */
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .bot-message.user .text { background: #95ec69; color: #000; }
        .bot-message.bot .text { background: #ffffff; color: #000; }
        .bot-message.system .text { 
            background: rgba(0,0,0,0.05); color: #666; font-size: var(--global-font-size, 12px); 
            padding: 4px 10px; border-radius: 4px; box-shadow: none; 
        }
        .bot-message .meta { font-size: 10px; color: #b2b2b2; margin-top: 4px; padding: 0 4px; }

        .bot-input-area {
            /* position: absolute; æ”¹ä¸ºæ­£å¸¸æµå¸ƒå±€ */
            background: #fff;
            padding: 12px 16px;
            display: flex;
            gap: 8px;
            border-top: 1px solid #eee;
            align-items: flex-end;
            flex-shrink: 0;
        }
        .bot-input {
            flex: 1;
            border: none;
            background: #f5f5f5;
            padding: 8px 12px;
            border-radius: 12px;
            font-size: var(--global-font-size, 14px);
            max-height: 80px;
            resize: none;
            outline: none;
            height: 36px;
        }
        .bot-input:focus { background: #fff; box-shadow: 0 0 0 2px #95ec69; }
        .bot-send-btn {
            width: 36px; height: 36px;
            border-radius: 50%;
            background: #95ec69;
            color: white;
            border: none;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            font-size: var(--global-font-size, 16px);
            flex-shrink: 0;
        }
        
        /* Bot Settings Dialog */
        .bot-settings-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.98);
            z-index: 10;
            padding: 20px;
            display: none;
            flex-direction: column;
        }
        .bot-settings-btn {
            /* position: absolute; top: 10px; right: 50px; æ”¹ä¸ºæ­£å¸¸ flex å¸ƒå±€ */
            background: none; border: none; font-size: 18px; cursor: pointer; color: #666;
            z-index: 5;
            padding: 4px 8px;
        }
        .bot-status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .bot-dot-connected { background: #07c160; }
        .bot-dot-disconnected { background: #fa5151; }
        .bot-dot-connecting { background: #ffc300; }

        /* Dialog å®¹å™¨ (å…³é”®ä¿®å¤: æ¢å¤éšè—çŠ¶æ€) */
        .modal, .confirm-modal {
            display: none; /* é»˜è®¤éšè— */
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
            backdrop-filter: blur(2px);
        }

        /* Dialog æ ·å¼å¾®è°ƒ (GitHubé£) */
        .modal-content, .confirm-content {
            background-color: white;
            margin: 10% auto; /* å±…ä¸­ */
            padding: 0;
            border-radius: 6px;
            border: 1px solid #d0d7de;
            box-shadow: 0 8px 24px rgba(140,149,159,0.2);
            width: 80%;
            max-width: 350px;
            overflow: hidden; /* é˜²æ­¢åœ†è§’æº¢å‡º */
        }
        .modal-header {
            background-color: #f6f8fa;
            border-bottom: 1px solid #d0d7de;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 0;
            line-height: 1;
        }
        .close-btn:hover {
            color: #24292f;
        }
        .modal-body, .confirm-content > * {
            padding: 16px;
        }
        .confirm-content {
            padding: 0; /* é‡ç½®ï¼Œç”±å†…éƒ¨å…ƒç´ æ§åˆ¶ padding */
        }
        .confirm-content h3 {
            margin: 0;
            padding: 16px;
            background-color: #f6f8fa;
            border-bottom: 1px solid #d0d7de;
            font-size: var(--global-font-size, 14px);
        }
        .confirm-content p {
            padding: 0 16px;
            margin: 16px 0;
        }
        .confirm-content input {
            display: block;
            width: calc(100% - 32px);
            margin: 0 16px 16px;
            padding: 5px 12px;
            border: 1px solid #d0d7de;
            border-radius: 6px;
        }
        .modal-buttons {
            padding: 16px;
            border-top: 1px solid #d0d7de;
            background-color: #f6f8fa;
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin: 0;
        }

        /* åº•éƒ¨æŠ½å±‰æ ·å¼ */
        .bottom-sheet {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 500px;
            background: #fff;
            border-radius: 16px 16px 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            max-height: 70vh;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s ease-out;
            z-index: 1002;
        }
        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(100%); }
            to { transform: translateX(-50%) translateY(0); }
        }
        @keyframes slideDown {
            from { transform: translateX(-50%) translateY(0); }
            to { transform: translateX(-50%) translateY(100%); }
        }
        .bottom-sheet.closing {
            animation: slideDown 0.2s ease-in forwards;
        }
        .sheet-handle {
            width: 40px;
            height: 4px;
            background: #d0d7de;
            border-radius: 2px;
            margin: 12px auto 8px;
            cursor: grab;
        }
        .sheet-handle:active { cursor: grabbing; }
        .sheet-header {
            padding: 8px 16px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #f0f0f0;
        }
        .sheet-close-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #f0f0f0;
            border: none;
            color: #666;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .sheet-close-btn:hover {
            background: #e0e0e0;
            color: #333;
        }
        .sheet-content {
            flex: 1;
            overflow-y: auto;
            padding-bottom: max(16px, env(safe-area-inset-bottom));
        }
        /* é®ç½©å±‚ç‚¹å‡»å…³é—­ */
        .modal-close-on-backdrop { cursor: pointer; }

        .modal-title { font-size: var(--global-font-size, 14px); font-weight: 600; color: #24292f; }
        .modal-item { 
            padding: 10px 16px; 
            border-bottom: 1px solid #d0d7de; 
            cursor: pointer;
            font-size: var(--global-font-size, 14px);
            color: #24292f;
        }
        .modal-item:last-child { border-bottom: none; }
        .modal-item:hover { background-color: #0969da; color: white; }
        .modal-item.delete-item { color: #cf222e; }
        .modal-item.delete-item:hover { background-color: #cf222e; color: white; }

        /* é…ç½®æ¨¡æ€æ¡† */
        #configModal .modal-content { width: 320px; }
        .config-section { padding: 20px; }
        .config-label { display: block; margin-bottom: 10px; font-weight: 500; }
        .font-size-slider { width: 100%; margin-bottom: 15px; }
        .font-preview { 
            padding: 15px; background: #f6f8fa; border-radius: 6px; text-align: center; 
            margin-bottom: 15px; font-size: var(--global-font-size, 14px); 
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            body { padding: 0; }
            .container { border: none; border-radius: 0; }
            .file-item { padding: 12px 16px; }
            .file-col-icon { width: 40px; margin-right: 12px; }
            .file-thumbnail { width: 40px; height: 40px; }
            .file-icon { font-size: 24px; }
            .file-name { font-size: 15px; }
            .breadcrumb { padding: 12px 16px; }
        }
    </style>
    <input type="hidden" id="currentBrowsePath" value="{{ get_relative_path(current_dir) }}">
    <input type="hidden" id="rootDir" value="{{ ROOT_DIR }}">
</head>
<body>
    <div id="taskListenerBar" class="task-listener-bar" role="status" aria-live="polite" aria-hidden="true" style="display:none;">
        <div class="task-spinner" aria-hidden="true"></div>
        <div id="taskListenerText" class="task-listener-text">æ­£åœ¨ç›‘å¬ä»»åŠ¡çŠ¶æ€â€¦</div>
    </div>
    <div class="container">
        <div class="breadcrumb">
            <!-- åµŒå…¥å¼ä¸Šä¼ æŒ‰é’® -->
            <form method="post" action="{{ url_for('file.upload_file', path=get_relative_path(current_dir)) }}" enctype="multipart/form-data" id="uploadForm">
                <input type="file" name="file" id="fileInputInline" onchange="handleFileSelect(event)" style="display: none;">
                <div class="upload-btn-inline" onclick="openCreateMenuDrawer()" title="åˆ›å»º">+</div>
            </form>

            <div class="breadcrumb-left">
                <a href="#" onclick="openTrashDrawer(); return false;" style="color: #dc3545; text-decoration: none; margin-right: 8px;" title="å›æ”¶ç«™">ğŸ—‘ï¸</a>
                <span style="color: #ddd; margin-right: 8px;">|</span>
                <a href="{{ url_for('file.browse') }}" style="color: #ffc107; margin-right: 8px;" title="æ ¹ç›®å½•">ğŸ </a>
                {% if breadcrumbs %}
                    <span class="crumb-sep">/</span>
                {% else %}
                     <strong>({{ items|length }})</strong>
                {% endif %}
                {% for crumb in breadcrumbs %}
                    {% if loop.last %}
                        <strong>{{ crumb.name }} ({{ items|length }})</strong>
                    {% else %}
                        <a href="{{ url_for('file.browse', path=get_relative_path(crumb.path)) }}">{{ crumb.name }}</a>
                        <span class="crumb-sep">/</span>
                    {% endif %}
                {% endfor %}
                <!-- æœç´¢æŒ‰é’® -->
                <button onclick="openSearchModal()" style="margin-left: 8px; background: none; border: none; cursor: pointer; font-size: var(--global-font-size, 16px); opacity: 0.6;" title="æœç´¢ (Ctrl+F)">ğŸ”</button>
            </div>
            <div style="display: flex; gap: 8px;">
                {% if current_dir != ROOT_DIR %}
                <a href="{{ url_for('file.browse', path=get_relative_path(os.path.dirname(current_dir))) }}" class="up-btn">â†‘</a>
                {% endif %}
            </div>
        </div>

        {% if message %}
        <div class="message {% if msg_type == 'success' %}success{% else %}error{% endif %}">
            {{ message }}
        </div>
        {% endif %}

        <div class="files-section">
            {% if items %}
            <div class="file-list">
                {% for item in items %}
                <div class="file-item" id="file-item-{{ loop.index }}" data-path="{{ get_relative_path(item.path) }}" data-is-dir="{{ 'true' if item.is_dir else 'false' }}">
                    <!-- ç¬¬ä¸€åˆ—ï¼šé¢„è§ˆå›¾æˆ–å›¾æ ‡ + å¤é€‰æ¡† -->
                    <div class="file-col-icon">
                        <input type="checkbox" class="file-checkbox" data-path="{{ get_relative_path(item.path) }}" onchange="toggleItemSelection('{{ get_relative_path(item.path) }}', this)" style="margin-right: 8px; cursor: pointer;">
                        {% if item.is_image %}
                            <img src="{{ url_for('file.thumbnail', path=get_relative_path(item.path)) }}" alt="{{ item.name }}" class="file-thumbnail" onerror="this.style.display='none';">
                        {% else %}
                            <span class="file-icon">{{ item.icon }}</span>
                        {% endif %}
                    </div>
                    
                    <!-- ç¬¬äºŒåˆ—ï¼šåç§° + è¯¦æƒ… -->
                    <div class="file-col-info">
                        <div class="file-name">
                            {% if item.is_dir %}
                                <a href="{{ url_for('file.browse', path=get_relative_path(item.path)) }}" style="color: inherit; text-decoration: none;">{{ item.name }}</a>
                            {% else %}
                                {% set ext = (item.name.split('.')|last if '.' in item.name else '')|lower %}
                                {% if ext in ['pdf', 'mp4', 'webm', 'ogg', 'mov', 'avi', 'mkv', 'mp3', 'wav', 'flac', 'aac', 'm4a', 'svg', 'ico', 'webp', 'avif'] %}
                                <a href="{{ url_for('file.serve_file', path=get_relative_path(item.path)) }}" target="_blank" style="color: inherit; text-decoration: none;">{{ item.name }}</a>
                                {% else %}
                                <a href="{{ url_for('file.view_file', path=get_relative_path(item.path)) }}" style="color: inherit; text-decoration: none;">{{ item.name }}</a>
                                {% endif %}
                            {% endif %}
                            {% if item.is_dir and item.name|starts_with_port %}
                                <a href="http://{{ request.host.split(':')[0] }}:{{ item.name|extract_port }}" target="_blank" style="margin-left: 8px; color: #17a2b8; text-decoration: none; font-size: 1.2em;" title="æ‰“å¼€ç½‘ç«™">ğŸ”—</a>
                            {% endif %}
                        </div>
                        <div class="file-details-inline">
                            <span class="file-size">{{ item.size }}</span>
                            <span class="file-modified">{{ item.modified }}</span>
                        </div>
                    </div>
                    
                    <!-- ç¬¬ä¸‰åˆ—ï¼šæ“ä½œæŒ‰é’® -->
                    <div class="file-col-actions">
                        {% if not item.is_dir %}
                        {% set ext = (item.name.split('.')|last if '.' in item.name else '')|lower %}
                        {# Excel/Word é¢„è§ˆ #}
                        {% if ext in ['xlsx', 'xls', 'docx', 'doc'] %}
                        <button class="preview-btn" onclick="event.stopPropagation(); openPreview('{{ get_relative_path(item.path) }}', '{{ item.name }}')" title="åœ¨çº¿é¢„è§ˆ">ğŸ”­</button>
                        {# Chrome åŸç”Ÿæ”¯æŒæ ¼å¼ â†’ æ–°çª—å£æ‰“å¼€ #}
                        {% elif ext in ['pdf', 'mp4', 'webm', 'ogg', 'mov', 'avi', 'mkv', 'mp3', 'wav', 'flac', 'aac', 'm4a', 'svg', 'ico', 'webp', 'avif'] %}
                        <a class="preview-btn" href="{{ url_for('file.serve_file', path=get_relative_path(item.path)) }}" target="_blank" title="æ–°çª—å£æ‰“å¼€">ğŸ‘ï¸</a>
                        {# å…¶ä»–æ–‡æœ¬æ–‡ä»¶ â†’ æŸ¥çœ‹å™¨ #}
                        {% elif ext in ['txt', 'md', 'json', 'xml', 'js', 'css', 'html', 'htm', 'py', 'sh', 'yaml', 'yml', 'csv'] %}
                        <a class="preview-btn" href="{{ url_for('file.view_file', path=get_relative_path(item.path)) }}" title="æŸ¥çœ‹å™¨">ğŸ“„</a>
                        {% endif %}
                        {% endif %}
                        <!-- èœå•æŒ‰é’® -->
                        <div class="menu-btn" onclick="showMenuModal('{{ get_relative_path(item.path) }}', '{{ item.name }}', {{ 'true' if item.is_dir else 'false' }})">
                            <span>â‹®</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-directory">
                <p>æ­¤ç›®å½•ä¸ºç©º</p>
            </div>
            {% endif %}
        </div>

    </div><!-- end container -->

    <!-- èœå•æŒ‰é’® -->
    <div class="menu-float-btn" onclick="openMainMenuModal()" title="èœå•">
        â˜°
    </div>

    <!-- ä¸»èœå•æŠ½å±‰ -->
    <div id="mainMenuDrawer" class="right-drawer">
        <div class="right-drawer-header">
            <div class="drawer-title">å¼€å§‹èœå•</div>
            <button class="drawer-close-btn" onclick="closeMainMenuModal()">&times;</button>
        </div>
        <div class="right-drawer-content" id="mainMenuItems">
            <!-- èœå•é¡¹ç”± JS åŠ¨æ€æ¸²æŸ“ -->
            <div style="text-align: center; padding: 20px; color: #666;">åŠ è½½ä¸­...</div>
        </div>
    </div>
    <div id="mainMenuBackdrop" class="right-drawer-backdrop" onclick="closeMainMenuModal()"></div>

    <!-- Bot Drawer é®ç½©å±‚ -->
    <div id="botBackdrop" class="drawer-backdrop" onclick="closeBotModal()"></div>
    <div id="botDrawer" class="drawer" style="height: 80vh;">
        <!-- æ‹–æ‹½æ‰‹æŸ„ -->
        <div class="drawer-handle" id="botDrawerHandle"></div>
        
        <!-- Header -->
        <div class="drawer-header">
            <button class="bot-settings-btn" onclick="toggleBotSettings()" style="background: none; border: none; font-size: var(--global-font-size, 16px); cursor: pointer; padding: 4px;">âš™ï¸</button>
            <div class="drawer-title">ğŸ¤– æ™ºèƒ½åŠ©æ‰‹</div>
            <button class="drawer-close-btn" onclick="closeBotModal()">&times;</button>
        </div>
        
        <div class="bot-container">
            <!-- Settings Overlay -->
            <div id="botSettings" class="bot-settings-overlay">
                <h4>è®¾ç½® & çŠ¶æ€</h4>
                <div style="margin: 10px 0; font-size: var(--global-font-size, 13px); color: #666;">
                    <span id="botWsDot" class="bot-status-dot bot-dot-disconnected"></span>
                    <span id="botWsStatus">æœªè¿æ¥</span>
                </div>
                
                <input type="text" id="botTokenInput" placeholder="Gateway Token" value="48d6818aace0430b504d27a7c100669ed8f4694da9d6eb95" style="margin-bottom: 10px; width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                <div style="display: flex; gap: 10px;">
                    <button onclick="botConnect()" class="dialog-btn dialog-btn-primary" style="padding: 8px;">è¿æ¥</button>
                    <button onclick="botClear()" class="dialog-btn dialog-btn-danger" style="padding: 8px;">æ¸…ç©ºè®°å½•</button>
                </div>
                <div style="margin-top: 20px; font-size: var(--global-font-size, 12px); color: #999;">
                    å·²å‘é€: <span id="botSentCount">-</span> | è½®æ¬¡: <span id="botConvCount">-</span>
                </div>
                <button onclick="toggleBotSettings()" class="dialog-btn" style="margin-top: auto; background: #ddd;">å…³é—­è®¾ç½®</button>
            </div>

            <div class="bot-chat-box" id="botChatBox">
                <ul id="botHistoryList" class="bot-history" style="list-style: none; padding: 0; margin: 0;"></ul>
            </div>
            
            <div class="bot-input-area">
                <textarea class="bot-input" id="botInput" placeholder="è¾“å…¥æ¶ˆæ¯..." style="flex: 1; border: 1px solid #ddd; background: #f5f5f5; padding: 10px 12px; border-radius: 8px; font-size: var(--global-font-size, 14px); resize: none; outline: none; height: 40px; max-height: 100px;"></textarea>
                <button class="bot-send-btn" onclick="botSend()" style="width: 40px; height: 40px; border-radius: 8px; background: #95ec69; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0;">ğŸš€</button>
            </div>
        </div>
    </div>

    <!-- ä¸Šä¼ çŠ¶æ€æ˜¾ç¤º -->
    <div id="uploadStatus" class="upload-status"></div>

    <!-- é¢„è§ˆæŠ½å±‰ -->
    <div id="previewBackdrop" class="drawer-backdrop" onclick="closePreviewModal()"></div>
    <div id="previewModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title" id="previewTitle">é¢„è§ˆ</div>
            <button class="drawer-close-btn" onclick="closePreviewModal()">&times;</button>
        </div>
        <div class="drawer-content">
            <!-- é¢„è§ˆå†…å®¹å°†åŠ¨æ€æ’å…¥ -->
        </div>
    </div>

    <!-- èœå•æŠ½å±‰ -->
    <div id="menuModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title" id="menuTitle">èœå•</div>
            <button class="drawer-close-btn" onclick="closeMenuModal()">&times;</button>
        </div>
        <div class="drawer-content">
            <div class="modal-item" onclick="handleMenuAction('details')">ğŸ“‹ æŸ¥çœ‹è¯¦æƒ…</div>
            <div class="modal-item" onclick="handleMenuAction('download')">ä¸‹è½½æ–‡ä»¶</div>
            <div class="modal-item" onclick="handleMenuAction('copyUrl')">å¤åˆ¶ä¸‹è½½åœ°å€</div>
            <div class="modal-item" onclick="handleMenuAction('copyPath')">å¤åˆ¶ç›¸å¯¹è·¯å¾„</div>
            <div class="modal-item" onclick="handleMenuAction('rename')">é‡å‘½å</div>
            <div class="modal-item" onclick="handleMenuAction('cut')" aria-label="å‰ªåˆ‡">å‰ªåˆ‡</div>
            <div class="modal-item" onclick="handleMenuAction('copy')" aria-label="å¤åˆ¶">å¤åˆ¶</div>
            <div class="modal-item" onclick="handleMenuAction('chat')">ğŸ’¬ æ·»åŠ åˆ°å¯¹è¯</div>
            <div class="modal-item" onclick="handleMenuAction('terminal')">ğŸ“º åœ¨ç»ˆç«¯æ‰“å¼€</div>
            <div class="modal-item delete-item" onclick="handleMenuAction('delete')">åˆ é™¤</div>
        </div>
    </div>

    <div id="createMenuBackdrop" class="drawer-backdrop" onclick="closeCreateMenuDrawer()"></div>
    <div id="createMenuDrawer" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">åˆ›å»º</div>
            <button class="drawer-close-btn" onclick="closeCreateMenuDrawer()">&times;</button>
        </div>
        <div class="drawer-content">
            <div class="modal-item" onclick="createMenuUpload()">ğŸ“¤ ä¸Šä¼ </div>
            <div class="modal-item" onclick="createMenuNewFolder()">ğŸ“ æ–°å»ºæ–‡ä»¶å¤¹</div>
            <div class="modal-item" onclick="createMenuNewFile()">ğŸ“„ æ–°å»ºæ–‡ä»¶</div>
        </div>
    </div>

    <div id="dialogBackdrop" class="drawer-backdrop" onclick="closeDialogDrawer()"></div>
    <div id="dialogDrawer" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title" id="dialogTitle">æç¤º</div>
            <button class="drawer-close-btn" onclick="closeDialogDrawer()">&times;</button>
        </div>
        <div class="drawer-content">
            <p id="dialogMessage" style="margin: 0 0 12px 0; color: #666; font-size: var(--global-font-size, 14px);"></p>
            <input type="text" id="dialogInput" style="width: 100%; padding: 12px; margin-bottom: 16px; border: 1px solid #ddd; border-radius: 8px; font-size: var(--global-font-size, 14px); box-sizing: border-box;">
            <div class="modal-buttons" style="padding: 0; border: none; background: none; gap: 12px; display:flex;">
                <button style="flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #d0d7de; background: #f6f8fa; cursor: pointer;" onclick="closeDialogDrawer()">å–æ¶ˆ</button>
                <button id="dialogConfirmBtn" style="flex: 1; padding: 12px; border-radius: 8px; border: 1px solid transparent; background: #2da44e; color: #fff; cursor: pointer;" onclick="confirmDialogDrawer()">ç¡®è®¤</button>
            </div>
        </div>
    </div>

    <!-- åˆ é™¤ç¡®è®¤æŠ½å±‰ -->
    <div id="confirmBackdrop" class="drawer-backdrop" onclick="closeConfirmModal()"></div>
    <div id="confirmModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">ç¡®è®¤åˆ é™¤</div>
            <button class="drawer-close-btn" onclick="closeConfirmModal()">&times;</button>
        </div>
        <div class="drawer-content">
            <p style="margin: 0 0 12px 0; color: #666; font-size: var(--global-font-size, 14px);">æ‚¨ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé¡¹ç›®å—ï¼Ÿ</p>
            <p id="itemNameToDelete" style="font-weight: bold; margin: 0 0 16px 0; font-size: var(--global-font-size, 16px);"></p>
            <div class="modal-buttons" style="padding: 0; border: none; background: none; gap: 12px;">
                <button class="modal-btn modal-btn-cancel" style="flex: 1; padding: 12px; border-radius: 8px;" onclick="closeConfirmModal()">å–æ¶ˆ</button>
                <button class="modal-btn modal-btn-confirm" style="flex: 1; padding: 12px; border-radius: 8px;" onclick="performDelete()">ç¡®è®¤åˆ é™¤</button>
            </div>
        </div>
    </div>

    <!-- è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="detailsBackdrop" class="drawer-backdrop" onclick="closeDetailsModal()"></div>
    <div id="detailsModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">ğŸ“‹ æ–‡ä»¶è¯¦æƒ…</div>
            <button class="drawer-close-btn" onclick="closeDetailsModal()">&times;</button>
        </div>
        <div class="drawer-content" id="detailsContent">
            <!-- å†…å®¹ç”± JS å¡«å…… -->
        </div>
    </div>

    <!-- é‡å‘½åæŠ½å±‰ -->
    <div id="renameBackdrop" class="drawer-backdrop" onclick="closeRenameModal()"></div>
    <div id="renameModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">é‡å‘½å</div>
            <button class="drawer-close-btn" onclick="closeRenameModal()">&times;</button>
        </div>
        <div class="drawer-content">
            <p style="margin: 0 0 12px 0; color: #666; font-size: var(--global-font-size, 14px);">è¯·è¾“å…¥æ–°åç§°</p>
            <input type="text" id="renameInput" style="width: 100%; padding: 12px; margin-bottom: 16px; border: 1px solid #ddd; border-radius: 8px; font-size: var(--global-font-size, 14px); box-sizing: border-box;">
            <div class="modal-buttons" style="padding: 0; border: none; background: none; gap: 12px;">
                <button class="modal-btn modal-btn-cancel" style="flex: 1; padding: 12px; border-radius: 8px;" onclick="closeRenameModal()">å–æ¶ˆ</button>
                <button class="modal-btn modal-btn-confirm" style="flex: 1; padding: 12px; border-radius: 8px;" onclick="performRename()">ç¡®è®¤</button>
            </div>
        </div>
    </div>

    <!-- ç§»åŠ¨æŠ½å±‰ -->
    <div id="moveBackdrop" class="drawer-backdrop" onclick="closeMoveModal()"></div>
    <div id="moveModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">ç§»åŠ¨åˆ°</div>
            <button class="drawer-close-btn" onclick="closeMoveModal()">&times;</button>
        </div>
        <div class="drawer-content">
            <p style="margin: 0 0 12px 0; color: #666; font-size: var(--global-font-size, 14px);">è¯·è¾“å…¥ç›®æ ‡è·¯å¾„ï¼ˆç›¸å¯¹äºæ ¹ç›®å½•ï¼‰ï¼š</p>
            <input type="text" id="moveInput" style="width: 100%; padding: 12px; margin-bottom: 16px; border: 1px solid #ddd; border-radius: 8px; font-size: var(--global-font-size, 14px); box-sizing: border-box;" placeholder="ä¾‹å¦‚ï¼štjx/æ–°æ–‡ä»¶å¤¹å">
            <div class="modal-buttons" style="padding: 0; border: none; background: none; gap: 12px;">
                <button class="modal-btn modal-btn-cancel" style="flex: 1; padding: 12px; border-radius: 8px;" onclick="closeMoveModal()">å–æ¶ˆ</button>
                <button class="modal-btn modal-btn-confirm" style="flex: 1; padding: 12px; border-radius: 8px;" onclick="performMove()">ç¡®è®¤</button>
            </div>
        </div>
    </div>

    <!-- å…‹éš†æŠ½å±‰ -->
    <div id="cloneBackdrop" class="drawer-backdrop" onclick="Drawer.close('cloneModal')"></div>
    <div id="cloneModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">å…‹éš†ä¸­...</div>
            <button class="drawer-close-btn" onclick="Drawer.close('cloneModal')">&times;</button>
        </div>
        <div class="drawer-content">
            <p id="cloneStatus" style="text-align: center; color: #666;">æ­£åœ¨å¤„ç†...</p>
        </div>
    </div>

    <!-- Terminal Drawer -->
    <div id="terminalBackdrop" class="drawer-backdrop" onclick="closeTerminal()"></div>
    <div id="terminalDrawer">
        <!-- æ‹–æ‹½æ‰‹æŸ„ -->
        <div class="drawer-handle" id="terminalDrawerHandle"></div>
        <!-- Header -->
        <div class="drawer-header">
            <span style="font-size:14px;">ğŸ–¥ï¸ ç»ˆç«¯</span>
            <button class="drawer-close-btn" onclick="closeTerminal()">&times;</button>
        </div>
        <!-- è™šæ‹Ÿé”®ç›˜ -->
        <div class="terminal-keyboard" style="background:#222;padding:6px;display:flex;flex-wrap:wrap;gap:4px;user-select:none;border-bottom:1px solid #333;">
            <button class="term-key" onmousedown="handleKeyBtn(event, 'ctrl')" ontouchstart="handleKeyBtn(event, 'ctrl')">Ctrl</button>
            <button class="term-key" onmousedown="handleKeyBtn(event, 'alt')" ontouchstart="handleKeyBtn(event, 'alt')">Alt</button>
            <button class="term-key" onmousedown="handleKeyBtn(event, 'tab')" ontouchstart="handleKeyBtn(event, 'tab')">Tab</button>
            <button class="term-key" onmousedown="handleKeyBtn(event, 'esc')" ontouchstart="handleKeyBtn(event, 'esc')">Esc</button>
            <button class="term-key" onmousedown="handleKeyBtn(event, 'enter')" ontouchstart="handleKeyBtn(event, 'enter')">â†µ</button>
            <button class="term-key" onmousedown="handleKeyBtn(event, 'up')" ontouchstart="handleKeyBtn(event, 'up')">â†‘</button>
            <button class="term-key" onmousedown="handleKeyBtn(event, 'down')" ontouchstart="handleKeyBtn(event, 'down')">â†“</button>
            <button class="term-key" onmousedown="handleKeyBtn(event, 'backspace')" ontouchstart="handleKeyBtn(event, 'backspace')">âŒ«</button>
        </div>
        <!-- Ctrlç»„åˆé”® -->
        <div class="terminal-ctrl-keys" id="ctrlKeysArea" style="background:#1a1a1a;padding:6px;display:none;flex-wrap:wrap;gap:3px;border-bottom:1px solid #333;user-select:none;">
            <span style="color:#888;font-size:12px;width:100%;margin-bottom:4px;">ç»„åˆé”®ï¼š</span>
            <button class="term-key term-key-small" onmousedown="handleCtrlBtn(event, 'a')" ontouchstart="handleCtrlBtn(event, 'a')">A</button>
            <button class="term-key term-key-small" onmousedown="handleCtrlBtn(event, 'c')" ontouchstart="handleCtrlBtn(event, 'c')">C</button>
            <button class="term-key term-key-small" onmousedown="handleCtrlBtn(event, 'd')" ontouchstart="handleCtrlBtn(event, 'd')">D</button>
            <button class="term-key term-key-small" onmousedown="handleCtrlBtn(event, 'l')" ontouchstart="handleCtrlBtn(event, 'l')">L</button>
            <button class="term-key term-key-small" onmousedown="handleCtrlBtn(event, 'p')" ontouchstart="handleCtrlBtn(event, 'p')">P</button>
            <button class="term-key term-key-small" onmousedown="handleCtrlBtn(event, 'u')" ontouchstart="handleCtrlBtn(event, 'u')">U</button>
            <button class="term-key term-key-small" onmousedown="handleCtrlBtn(event, 'z')" ontouchstart="handleCtrlBtn(event, 'z')">Z</button>
        </div>
        <style>
            .terminal-keyboard .term-key, .terminal-ctrl-keys .term-key {
                background:#444;border:none;color:#fff;padding:8px 10px;border-radius:4px;font-size:13px;cursor:pointer;min-width:36px;touch-action:manipulation;transition:all 0.15s;-webkit-tap-highlight-color:transparent;
            }
            .terminal-keyboard .term-key:active, .terminal-ctrl-keys .term-key:active { background:#666;transform:scale(0.95); }
            .term-key.active { background:#0969da !important; }
            .term-key-small { padding:6px 10px !important;font-size:12px !important;min-width:30px !important; }
            @media (min-width:768px) { .terminal-keyboard, .terminal-ctrl-keys { display:none !important; } }
        </style>
        <div id="terminal-container" style="flex:1;overflow:hidden;background:#000;"></div>
    </div>

    <!-- è¿›ç¨‹ç®¡ç†æŠ½å±‰æ ·å¼ï¼ˆå¤åˆ¶ç»ˆç«¯æŠ½å±‰ï¼‰ -->
    <style>
        #processModal {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            background: #fff;
            border-radius: 16px 16px 0 0;
            transform: translateY(110%);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            max-height: 85vh;
        }
        #processModal.open {
            transform: translateY(0);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
        }
        #processModal .drawer-header {
            background: #fff;
            border-bottom: 1px solid #eee;
        }
        #processModal .drawer-close-btn {
            color: #666;
        }
        #processModal .drawer-handle {
            background: #ddd;
        }
    </style>

    <!-- ç³»ç»Ÿè®¾ç½®æŠ½å±‰ -->
    <div id="configBackdrop" class="drawer-backdrop" onclick="closeConfigModal()"></div>
    <div id="configModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">âš™ï¸ ç³»ç»Ÿè®¾ç½®</div>
            <button class="drawer-close-btn" onclick="closeConfigModal()">&times;</button>
        </div>
        <div class="drawer-content" style="padding: 16px;">
            <div class="config-section">
                <label class="config-label">å…¨å±€å­—ä½“å¤§å°</label>
                <input type="range" id="fontSizeSlider" class="font-size-slider" min="12" max="24" value="14" onchange="updateFontSize(this.value)">
                <div id="fontPreview" class="font-preview" style="font-size: var(--global-font-size, 14px);">
                    é¢„è§ˆæ–‡å­— abc ABC 123
                </div>
                <div style="display: flex; justify-content: space-between; font-size: var(--global-font-size, 12px); color: #666;">
                    <span>å°</span>
                    <span>å¤§</span>
                </div>
            </div>
        </div>
    </div>

    <!-- æœç´¢æ¨¡æ€æ¡† -->
    <div id="searchBackdrop" class="drawer-backdrop" onclick="closeSearchModal()"></div>
    <div id="searchModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">ğŸ” æœç´¢æ–‡ä»¶</div>
            <div style="display:flex;gap:8px;">
                <button style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;" onclick="resetSearch()" title="é‡ç½®">ğŸ”„</button>
                <button class="drawer-close-btn" onclick="closeSearchModal()">&times;</button>
            </div>
        </div>
        <div class="drawer-content" style="padding:0;">
            <div style="padding: 16px;">
                <div style="display: flex; gap: 10px; margin-bottom: 16px;">
                    <input type="text" id="searchInput" style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: var(--global-font-size, 14px);" placeholder="è¾“å…¥æ–‡ä»¶åæœç´¢..." onkeyup="handleSearchKeyup(event)">
                    <button class="modal-btn modal-btn-confirm" style="padding: 12px 20px;" onclick="doSearch()">æœç´¢</button>
                </div>
                <div id="searchResults" style="overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <!-- å›æ”¶ç«™æŠ½å±‰ -->
    <div id="trashBackdrop" class="drawer-backdrop" onclick="closeTrashDrawer()"></div>
    <div id="trashDrawer" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">ğŸ—‘ï¸ å›æ”¶ç«™</div>
            <div style="display:flex;gap:8px;">
                <button style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;" onclick="loadTrashList()" title="åˆ·æ–°">ğŸ”„</button>
                <button style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;" onclick="clearTrash()" title="æ¸…ç©º">ğŸ§¹</button>
                <button class="drawer-close-btn" onclick="closeTrashDrawer()">&times;</button>
            </div>
        </div>
        <div class="drawer-content" style="padding:0;">
            <div id="trashListContainer" style="padding: 16px;"></div>
        </div>
    </div>
    <!-- è¿›ç¨‹ç®¡ç†æŠ½å±‰ -->
    <div id="processBackdrop" class="drawer-backdrop" onclick="closeProcessModal()"></div>
    <div id="processModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">âš™ï¸ è¿›ç¨‹ç®¡ç†</div>
            <div style="display:flex;gap:8px;">
                <button style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;" onclick="loadProcessList()" title="åˆ·æ–°">ğŸ”„</button>
                <button class="drawer-close-btn" onclick="closeProcessModal()">&times;</button>
            </div>
        </div>
        <div class="drawer-content" style="padding:0;">
            <div id="processListContainer" style="padding: 16px;"></div>
        </div>
    </div>

    <!-- ç³»ç»ŸåŒ…ç®¡ç†æŠ½å±‰ -->
    <div id="systemPackageBackdrop" class="drawer-backdrop" onclick="closeSystemPackageModal()"></div>
    <div id="systemPackageModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">ğŸ“¦ ç³»ç»ŸåŒ…ç®¡ç†</div>
            <div style="display:flex;gap:8px;">
                <button style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;" onclick="loadSystemPackageList()" title="åˆ·æ–°">ğŸ”„</button>
                <button class="drawer-close-btn" onclick="closeSystemPackageModal()">&times;</button>
            </div>
        </div>
        <div class="drawer-content" style="padding:0;">
            <div id="systemPackageListContainer" style="padding: 16px;"></div>
        </div>
    </div>

    <!-- Pip åŒ…ç®¡ç†æŠ½å±‰ -->
    <div id="pipBackdrop" class="drawer-backdrop" onclick="closePipModal()"></div>
    <div id="pipModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">ğŸ Pip åŒ…ç®¡ç†</div>
            <div style="display:flex;gap:8px;">
                <button style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;" onclick="loadPipList()" title="åˆ·æ–°">ğŸ”„</button>
                <button class="drawer-close-btn" onclick="closePipModal()">&times;</button>
            </div>
        </div>
        <div class="drawer-content" style="padding:0;">
            <div id="pipListContainer" style="padding: 16px;"></div>
        </div>
    </div>

    <!-- NPM åŒ…ç®¡ç†æŠ½å±‰ -->
    <div id="npmBackdrop" class="drawer-backdrop" onclick="closeNpmModal()"></div>
    <div id="npmModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">ğŸ“¦ NPM åŒ…ç®¡ç†</div>
            <div style="display:flex;gap:8px;">
                <button style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;" onclick="loadNpmList()" title="åˆ·æ–°">ğŸ”„</button>
                <button class="drawer-close-btn" onclick="closeNpmModal()">&times;</button>
            </div>
        </div>
        <div class="drawer-content" style="padding:0;">
            <div id="npmListContainer" style="padding: 16px;"></div>
        </div>
    </div>

    <!-- Docker ç®¡ç†æŠ½å±‰ -->
    <div id="dockerBackdrop" class="drawer-backdrop" onclick="closeDockerModal()"></div>
    <div id="dockerModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">ğŸ³ Docker ç®¡ç†</div>
            <div style="display:flex;gap:8px;">
                <button style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;" onclick="loadDockerTabs('images')" title="åˆ·æ–°">ğŸ”„</button>
                <button class="drawer-close-btn" onclick="closeDockerModal()">&times;</button>
            </div>
        </div>
        <div class="drawer-content" style="padding:0;">
            <div style="display: flex; border-bottom: 1px solid #d0d7de;">
                <button class="docker-tab active" data-tab="images" onclick="loadDockerTabs('images')" style="flex: 1; padding: 12px; background: none; border: none; cursor: pointer; font-size: 14px; border-bottom: 2px solid transparent;">é•œåƒ</button>
                <button class="docker-tab" data-tab="containers" onclick="loadDockerTabs('containers')" style="flex: 1; padding: 12px; background: none; border: none; cursor: pointer; font-size: 14px; border-bottom: 2px solid transparent;">å®¹å™¨</button>
            </div>
            <div id="dockerImagesContainer" style="padding: 16px;"></div>
            <div id="dockerContainersContainer" style="padding: 16px; display: none;"></div>
        </div>
    </div>

    <!-- Systemd æœåŠ¡ç®¡ç†æŠ½å±‰ -->
    <div id="systemdBackdrop" class="drawer-backdrop" onclick="closeSystemdModal()"></div>
    <div id="systemdModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">ğŸ”§ Systemd ç®¡ç†</div>
            <div style="display:flex;gap:8px;">
                <button style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;" onclick="loadSystemdList()" title="åˆ·æ–°">ğŸ”„</button>
                <button class="drawer-close-btn" onclick="closeSystemdModal()">&times;</button>
            </div>
        </div>
        <div class="drawer-content" style="padding:0;">
            <div id="systemdListContainer" style="padding: 16px;"></div>
        </div>
    </div>

    <!-- ç£ç›˜ç®¡ç†æŠ½å±‰ -->
    <div id="diskBackdrop" class="drawer-backdrop" onclick="closeDiskModal()"></div>
    <div id="diskModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">ğŸ’¾ ç£ç›˜ç®¡ç†</div>
            <div style="display:flex;gap:8px;">
                <button style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;" onclick="loadDiskList()" title="åˆ·æ–°">ğŸ”„</button>
                <button class="drawer-close-btn" onclick="closeDiskModal()">&times;</button>
            </div>
        </div>
        <div class="drawer-content" style="padding:0;">
            <div id="diskListContainer" style="padding: 16px;"></div>
        </div>
    </div>

    <!-- ç½‘ç»œç®¡ç†æŠ½å±‰ -->
    <div id="networkBackdrop" class="drawer-backdrop" onclick="closeNetworkModal()"></div>
    <div id="networkModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">ğŸŒ ç½‘ç»œç®¡ç†</div>
            <div style="display:flex;gap:8px;">
                <button style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;" onclick="loadNetworkList()" title="åˆ·æ–°">ğŸ”„</button>
                <button class="drawer-close-btn" onclick="closeNetworkModal()">&times;</button>
            </div>
        </div>
        <div class="drawer-content" style="padding:0;">
            <div id="networkListContainer" style="padding: 16px;"></div>
        </div>
    </div>

    <!-- Gitç®¡ç†æŠ½å±‰ -->
    <div id="gitBackdrop" class="drawer-backdrop" onclick="closeGitModal()"></div>
    <div id="gitModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">ğŸ”€ Gitç®¡ç†</div>
            <div style="display:flex;gap:8px;">
                <button style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;" onclick="loadGitList()" title="åˆ·æ–°">ğŸ”„</button>
                <button class="drawer-close-btn" onclick="closeGitModal()">&times;</button>
            </div>
        </div>
        <div class="drawer-content" style="padding:0;">
            <div id="gitListContainer" style="padding: 16px;"></div>
        </div>
    </div>

    <!-- GPUæ˜¾å¡æŠ½å±‰ -->
    <div id="gpuBackdrop" class="drawer-backdrop" onclick="closeGpuModal()"></div>
    <div id="gpuModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">ğŸ–¥ï¸ æ˜¾å¡ä¿¡æ¯</div>
            <div style="display:flex;gap:8px;">
                <button style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;" onclick="loadGpuInfo()" title="åˆ·æ–°">ğŸ”„</button>
                <button class="drawer-close-btn" onclick="closeGpuModal()">&times;</button>
            </div>
        </div>
        <div class="drawer-content" style="padding:0;">
            <div id="gpuInfoContainer" style="padding: 16px;"></div>
        </div>
    </div>

    <!-- Ollamaæ¨¡å‹æŠ½å±‰ -->
    <div id="ollamaBackdrop" class="drawer-backdrop" onclick="closeOllamaModal()"></div>
    <div id="ollamaModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">ğŸ¦™ Ollama æ¨¡å‹</div>
            <div style="display:flex;gap:8px;">
                <button style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;" onclick="loadOllamaModels()" title="åˆ·æ–°">ğŸ”„</button>
                <button class="drawer-close-btn" onclick="closeOllamaModal()">&times;</button>
            </div>
        </div>
        <div class="drawer-content" style="padding:0;">
            <div id="ollamaModelsContainer" style="padding: 16px;"></div>
        </div>
    </div>

    <!-- OpenClawé…ç½®æŠ½å±‰ -->
    <div id="openclawBackdrop" class="drawer-backdrop" onclick="closeOpenclawModal()"></div>
    <div id="openclawModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title">âš™ï¸ OpenClaw é…ç½®</div>
            <div style="display:flex;gap:8px;">
                <button style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;" onclick="loadOpenclawConfig()" title="åˆ·æ–°">ğŸ”„</button>
                <button class="drawer-close-btn" onclick="closeOpenclawModal()">&times;</button>
            </div>
        </div>
        <div class="drawer-content" style="padding:0;">
            <div id="openclawConfigContainer" style="padding: 16px;"></div>
        </div>
    </div>

        <!-- æ‰¹é‡æ“ä½œæŠ½å±‰ (æ— é®ç½©) -->
    <div id="batchDrawer" class="drawer" style="box-shadow: 0 -4px 20px rgba(0,0,0,0.15);">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title" style="display:flex;align-items:center;">
                <input type="checkbox" id="batchSelectAll" onchange="toggleSelectAll(this)" style="margin-right:8px;">
                <span id="batchCount">å·²é€‰ 0 é¡¹</span>
            </div>
            <button class="drawer-close-btn" onclick="clearSelection()">&times;</button>
        </div>
        <div class="drawer-content">
            <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap: 8px; padding: 16px;">
                <div class="modal-item" onclick="batchMove()" style="display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:12px; border:1px solid #eee; border-radius:8px; cursor:pointer;">
                    <span style="font-size:24px; margin-bottom:4px;">ğŸ“</span>
                    <span style="font-size:12px;">ç§»åŠ¨</span>
                </div>
                <div class="modal-item" onclick="batchCopy()" style="display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:12px; border:1px solid #eee; border-radius:8px; cursor:pointer;">
                    <span style="font-size:24px; margin-bottom:4px;">ğŸ“‹</span>
                    <span style="font-size:12px;">å¤åˆ¶</span>
                </div>
                <div class="modal-item delete-item" onclick="batchDelete()" style="display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:12px; border:1px solid #eee; border-radius:8px; color:#cf222e; cursor:pointer;">
                    <span style="font-size:24px; margin-bottom:4px;">ğŸ—‘ï¸</span>
                    <span style="font-size:12px;">åˆ é™¤</span>
                </div>
                <div class="modal-item" onclick="clearSelection()" style="display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:12px; border:1px solid #eee; border-radius:8px; cursor:pointer;">
                    <span style="font-size:24px; margin-bottom:4px;">âœ–</span>
                    <span style="font-size:12px;">å–æ¶ˆ</span>
                </div>
            </div>
        </div>
    </div>

    <div id="clipboardBar" class="clipboard-bar" role="region" aria-label="å‰ªè´´æ¿æ“ä½œ" aria-hidden="true" style="display:none;">
        <button id="clipboardPasteBtn" type="button" class="clipboard-paste-btn" aria-label="åœ¨æ­¤ç²˜è´´">
            <span id="clipboardLabel" aria-live="polite"></span>
        </button>
        <button id="clipboardCancelBtn" type="button" class="clipboard-cancel-btn" aria-label="å–æ¶ˆå‰ªè´´æ¿æ“ä½œ">Ã—</button>
    </div>

    <!-- Toast é€šçŸ¥å®¹å™¨ -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- ç›®æ ‡ä½ç½®é€‰æ‹©æŠ½å±‰ -->
    <div id="targetBackdrop" class="drawer-backdrop" onclick="closeTargetModal()"></div>
    <div id="targetModal" class="drawer">
        <div class="drawer-handle"></div>
        <div class="drawer-header">
            <div class="drawer-title" id="targetModalTitle">é€‰æ‹©ç›®æ ‡ä½ç½®</div>
            <button class="drawer-close-btn" onclick="closeTargetModal()">&times;</button>
        </div>
        <div class="drawer-content">
            <input type="text" id="targetPathInput" style="width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: var(--global-font-size, 14px); box-sizing: border-box;" placeholder="ä¾‹å¦‚ï¼štjx/æ–°æ–‡ä»¶å¤¹å">
            <p style="font-size: var(--global-font-size, 12px); color: #666; margin: 0 0 16px 0;">ç›¸å¯¹äºæ ¹ç›®å½•çš„è·¯å¾„</p>
            <div class="modal-buttons" style="padding: 0; border: none; background: none; gap: 12px;">
                <button class="modal-btn modal-btn-cancel" style="flex: 1; padding: 12px; border-radius: 8px;" onclick="closeTargetModal()">å–æ¶ˆ</button>
                <button class="modal-btn modal-btn-confirm" style="flex: 1; padding: 12px; border-radius: 8px;" onclick="confirmTargetPath()">ç¡®è®¤</button>
            </div>
        </div>
    </div>

    
</body>
</html>
